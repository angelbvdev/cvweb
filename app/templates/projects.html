{% extends "base.html" %}

{% block title %}Proyectos{% endblock %}

{% block content %}

<div class="container py-5">

    <h1 class="fw-bold text-center mb-4">Mis Proyectos</h1>
    <p class="text-center text-muted mb-5">
        Explora mis proyectos filtrando por categoría, tecnologías o usando la barra de búsqueda.
    </p>

    <!-- === BUSCADOR === -->
    <div class="input-group mb-4 shadow-sm">
        <span class="input-group-text bg-primary text-white">
            <i class="bi bi-search"></i>
        </span>
        <input id="searchInput" type="text" class="form-control"
               placeholder="Buscar por nombre, descripción o tecnología...">
    </div>

    <!-- === FILTROS === -->
    <div class="d-flex flex-wrap gap-2 mb-5 justify-content-center">

        <button class="btn btn-outline-primary filter-btn active" data-category="all">Todos</button>
        {% for cat in categorias %}
        <button class="btn btn-outline-primary filter-btn" data-category="{{ cat.slug }}">
            {{ cat.nombre }}
        </button>
        {% endfor %}

    </div>

    <!-- === GRID DE PROYECTOS === -->
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4" id="projectGrid">

        {% for p in proyectos %}
        <div class="col project-item"
             data-category="{{ p.category_slug }}"
             data-tags="{{ p.tags | join(',') }}"
             data-title="{{ p.title | lower }}"
             data-description="{{ p.short_description | lower }}">

            <div class="card h-100 shadow-sm border-0">

                <img src="{{ url_for('static', filename='projects/' ~ p.thumbnail) }}"
                     class="card-img-top" alt="{{ p.title }}">

                <div class="card-body">
                    <h5 class="card-title fw-bold">{{ p.title }}</h5>
                    <p class="card-text text-muted">{{ p.short_description }}</p>
                </div>

                <div class="card-footer bg-white border-0">
                    {% for tag in p.tags %}
                        <span class="badge rounded-pill bg-primary bg-opacity-25 text-primary me-1">
                            {{ tag }}
                        </span>
                    {% endfor %}
                </div>

                <div class="card-footer bg-white border-0 text-end">
                    <a href="{{ url_for('projects.project_detail', project_id=p.id) }}"
                        class="btn btn-outline-primary">
                        Ver más
                    </a>
                </div>

            </div>
        </div>
        {% endfor %}

    </div>

</div>

<!-- === SCRIPT DE FILTRO + BUSCADOR === -->
<script>
document.addEventListener("DOMContentLoaded", () => {

    const searchInput = document.getElementById("searchInput");
    const filterButtons = document.querySelectorAll(".filter-btn");
    const projectItems = document.querySelectorAll(".project-item");

    let currentCategory = "all";

    // FILTRO POR CATEGORÍA
    filterButtons.forEach(btn => {
        btn.addEventListener("click", () => {
            filterButtons.forEach(b => b.classList.remove("active"));
            btn.classList.add("active");

            currentCategory = btn.dataset.category;
            filtrar();
        });
    });

    // BUSQUEDA
    searchInput.addEventListener("input", () => filtrar());

    function filtrar() {
        const q = searchInput.value.toLowerCase();

        projectItems.forEach(item => {
            const title = item.dataset.title;
            const description = item.dataset.description;
            const tags = item.dataset.tags.toLowerCase();
            const category = item.dataset.category;

            const matchText =
                title.includes(q) ||
                description.includes(q) ||
                tags.includes(q);

            const matchCategory =
                currentCategory === "all" ||
                category === currentCategory;

            if (matchText && matchCategory) {
                item.style.display = "block";
            } else {
                item.style.display = "none";
            }
        });
    }

});
</script>

{% endblock %}
