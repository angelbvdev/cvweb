{% extends "base.html" %}

{% block title %}Writing - Angel Burgos{% endblock %}

{% block content %}

{# Background decorative glow #}
<div class="absolute top-0 left-1/2 -translate-x-1/2 w-[800px] h-[400px] bg-indigo-500/10 blur-[100px] rounded-full pointer-events-none -z-10"></div>

<section class="max-w-6xl mx-auto space-y-12 mb-20 relative">
  
  {# --- Header Section --- #}
  <header class="flex flex-col md:flex-row md:items-end justify-between gap-6 border-b border-slate-800/60 pb-8">
    <div class="space-y-4 max-w-2xl">
      <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full border border-indigo-500/30 bg-indigo-500/5 text-indigo-300 text-xs font-semibold uppercase tracking-wider shadow-[0_0_10px_rgba(99,102,241,0.2)]">
        <i class="bi bi-feather"></i> The Blog
      </div>
      <h1 class="text-4xl md:text-5xl font-extrabold text-white tracking-tight">
        Thoughts on <span class="text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 to-cyan-300">Code & Data</span>
      </h1>
      <p class="text-slate-400 text-lg leading-relaxed">
        Tutorials, deep dives, and notes on backend architecture, data pipelines, and the engineering journey.
      </p>
    </div>
    
    <div class="hidden md:flex flex-col items-end gap-2">
      <form class="relative group" method="get" action="{{ url_for('blog.index') }}">
        <input name="q" value="{{ q or '' }}" type="search" placeholder="Search articles..."
               class="bg-slate-900/50 border border-slate-800 rounded-full py-2 pl-4 pr-28 text-sm text-slate-300 placeholder:text-slate-600 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 outline-none transition-all w-80">
        {% if selected_tag %}
          <input type="hidden" name="tag" value="{{ selected_tag }}">
        {% endif %}
        <button type="submit" class="absolute right-11 top-1.5 h-8 w-8 rounded-full grid place-items-center text-slate-400 hover:text-indigo-300 hover:bg-slate-800/60 transition" aria-label="Search">
          <i class="bi bi-search"></i>
        </button>
        <a href="{{ url_for('blog.index') }}" class="absolute right-2 top-1.5 h-8 w-8 rounded-full grid place-items-center text-slate-500 hover:text-slate-200 hover:bg-slate-800/60 transition" aria-label="Clear">
          <i class="bi bi-x-lg"></i>
        </a>
      </form>
      <div class="flex items-center gap-3 text-xs text-slate-500">
        <span>Showing {{ posts|length }} of {{ total }}</span>
        <span class="text-slate-700">/</span>
        <a class="footer-link" href="{{ url_for('blog.rss') }}" title="RSS"><i class="bi bi-rss"></i> RSS</a>
      </div>
    </div>
  </header>

  {% if tags and tags|length > 0 %}
  <div class="flex flex-wrap gap-2">
    <a class="chip {{ 'chip-active' if not selected_tag else '' }}" href="{{ url_for('blog.index', q=q or None) }}">All</a>
    {% for t in tags %}
      <a class="chip {{ 'chip-active' if selected_tag == t.slug else '' }}"
         href="{{ url_for('blog.index', tag=t.slug, q=q or None) }}">
        {{ t.name }}{% if tag_counts.get(t.slug) is not none %} <span class="text-xs opacity-70">({{ tag_counts.get(t.slug, 0) }})</span>{% endif %}
      </a>
    {% endfor %}
  </div>
  {% endif %}

  {% if posts and posts|length > 0 %}
  {# --- Blog Grid --- #}
  <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8" id="blogGrid">
    {% for post in posts %}
    <article class="group flex flex-col h-full bg-slate-900/40 border border-slate-800/80 rounded-3xl overflow-hidden hover:border-indigo-500/30 hover:shadow-2xl hover:shadow-indigo-500/10 transition-all duration-300 hover:-translate-y-1 blog-card"
             data-title="{{ post.title }}"
             data-slug="{{ post.slug }}"
             data-excerpt="{{ post.excerpt or '' }}"
             data-status="{{ 'published' if (post.is_published is defined and post.is_published) else 'draft' }}">
      
      {# --- Image Area --- #}
      <a href="{{ url_for('blog.post_detail', slug=post.slug) }}" class="relative aspect-video overflow-hidden bg-slate-800">
        {% if post.cover_image_path %}
          <img src="{{ url_for('static', filename='uploads/blog/' ~ post.cover_image_path) }}" 
               alt="{{ post.title }}" 
               class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105">
        {% else %}
          {# Fallback decorative pattern if no image #}
          <div class="w-full h-full bg-gradient-to-br from-slate-800 to-slate-900 flex items-center justify-center group-hover:scale-105 transition-transform duration-700">
            <i class="bi bi-code-slash text-6xl text-slate-700/50"></i>
          </div>
        {% endif %}

        {# Draft Badge Overlay #}
        {% if post.is_published is defined and not post.is_published %}
        <div class="absolute top-3 right-3">
          <span class="px-3 py-1 rounded-lg bg-slate-950/80 backdrop-blur border border-slate-700 text-slate-300 text-xs font-bold uppercase tracking-wider shadow-lg">
            Draft Mode
          </span>
        </div>
        {% endif %}
      </a>

      {# --- Content Area --- #}
      <div class="flex flex-col flex-1 p-6">
        <div class="flex items-center gap-3 text-xs font-medium text-slate-500 mb-3">
          {% if post.display_date %}
            <time datetime="{{ post.display_date }}">{{ post.display_date.strftime('%b %d, %Y') }}</time>
          {% else %}
            <time datetime="{{ post.created_at }}">{{ post.created_at.strftime('%b %d, %Y') }}</time>
          {% endif %}
          <span class="w-1 h-1 rounded-full bg-slate-700"></span>
          <span>{{ post.reading_minutes or 5 }} min read</span>
        </div>

        <h2 class="text-xl font-bold text-white mb-3 leading-snug break-words group-hover:text-indigo-300 transition-colors">
          <a href="{{ url_for('blog.post_detail', slug=post.slug) }}">
            {{ post.title }}
          </a>
        </h2>

        <p class="text-slate-400 text-sm leading-relaxed line-clamp-3 break-words mb-6 flex-1">
          {{ post.excerpt or (post.content[:180] ~ 'â€¦' if post.content and post.content|length > 180 else post.content) }}
        </p>

        {% if post.tags is defined and post.tags %}
        <div class="flex flex-wrap gap-2 mb-4">
          {% for t in post.tags[:3] %}
            <a class="tag hover:opacity-90" href="{{ url_for('blog.index', tag=t.slug, q=q or None) }}">{{ t.name }}</a>
          {% endfor %}
          {% if post.tags|length > 3 %}
            <span class="tag">+{{ post.tags|length - 3 }}</span>
          {% endif %}
        </div>
        {% endif %}

        <div class="pt-4 border-t border-slate-800/50 flex items-center justify-between">
            <span class="text-sm font-semibold text-indigo-400 group-hover:translate-x-1 transition-transform inline-flex items-center gap-1">
                Read Article <i class="bi bi-arrow-right"></i>
            </span>
        </div>
      </div>
    </article>
    {% endfor %}
  </div>

  {% if pages and pages > 1 %}
  <nav class="flex flex-col sm:flex-row items-center justify-between gap-4 pt-6 border-t border-slate-800/60">
    <div class="text-sm text-slate-400">Page {{ page }} of {{ pages }}</div>
    <div class="flex items-center gap-2">
      {% set prev_page = page - 1 %}
      {% set next_page = page + 1 %}
      <a class="btn btn-secondary btn-sm {{ 'opacity-50 pointer-events-none' if page <= 1 else '' }}"
         href="{{ url_for('blog.index', q=q or None, tag=selected_tag or None, page=prev_page, per_page=per_page) }}">
        <i class="bi bi-arrow-left"></i> Prev
      </a>
      <a class="btn btn-secondary btn-sm {{ 'opacity-50 pointer-events-none' if page >= pages else '' }}"
         href="{{ url_for('blog.index', q=q or None, tag=selected_tag or None, page=next_page, per_page=per_page) }}">
        Next <i class="bi bi-arrow-right"></i>
      </a>
    </div>
  </nav>
  {% endif %}

  {% else %}
  
  {# --- Empty State --- #}
  <div class="card p-12 text-center border-dashed border-2 border-slate-800 bg-transparent">
    <div class="mx-auto h-20 w-20 rounded-3xl bg-slate-800/50 border border-slate-700 flex items-center justify-center mb-6 relative overflow-hidden group">
      <div class="absolute inset-0 bg-indigo-500/20 blur-xl group-hover:bg-indigo-500/30 transition-colors"></div>
      <i class="bi bi-journal-album text-3xl text-indigo-300 relative z-10"></i>
    </div>
    <h2 class="text-3xl font-bold text-white mb-3">Workspace Empty</h2>
    <p class="text-slate-400 max-w-lg mx-auto mb-8 text-lg">
      I haven't published any articles yet. I'm likely busy building the projects displayed in my portfolio.
    </p>
    <div class="flex flex-wrap gap-4 justify-center">
      <a class="btn btn-primary shadow-lg shadow-indigo-500/20" href="{{ url_for('projects.projects_home') }}">
        <i class="bi bi-grid-fill"></i> Browse Projects
      </a>
      <a class="btn btn-secondary" href="{{ url_for('main.contact') }}">
        <i class="bi bi-envelope"></i> Get in Touch
      </a>
    </div>
  </div>
  {% endif %}
</section>

{% endblock %}
